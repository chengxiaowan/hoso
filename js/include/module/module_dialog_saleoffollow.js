"use strict";define(["require"],function(o){return Vue.component("sale-follow",{template:'<div class="col-sm-12 form" id="follow-box">\n            <form class="m-t-sm row">\n                <div class="form-group col-sm-4">\n                    <select style="width:100%" v-model="type" class="form-control">\n                    <option v-if="dialogMode==1" selected value="">请选择跟进方式</option>\n                   <option  selected value="0">电话</option>\n               \t   <option v-if="dialogMode==1" value="1">QQ</option>\n                   <option v-if="dialogMode==1" value="2">微信</option>\n                   <option v-if="dialogMode==1" value="3">拜访</option>\n                   <option v-if="dialogMode==1" value="4">邮件</option>\n                   <option v-if="dialogMode==1" value="5">短信</option>\n                   <option v-if="dialogMode==1" value="6">其他</option>\n               </select>\n                </div>\n                <div class="form-group col-sm-12">\n                    <textarea class="form-control" style="resize:none" v-model="content" placeholder="跟进详情" rows="6" cols=""></textarea>\n                </div>\n                <div class="form-group col-sm-12">\n                    <div id="followFilesUploadBtn"></div>\n                </div>\n                <div class="form-group col-sm-12">\n\n                <table v-if="files.length" class="table table-bordered">\n                    <thead>\n                        <tr>\n                            <th>文件名</th>\n                            <th width="180">操作</th>\n</tr>\n                    </thead>\n                    <tbody>\n                        <tr v-for="(el,index) of files">\n                            <td>{{el.originalFilename}}</td>\n                            <td><a target="_blank" :href="el.url" class="btn btn-primary btn-sm">\n                            <i class="fa fa-eye"></i> 查看</a>\n                            <a @click="files_del(index)" target="_blank" class="btn btn-danger btn-sm"><i class="fa fa-trash"></i> 删除</a></td>\n                        </tr>\n                    </tbody>\n                </table>\n                </div>\n                <div class="form-group col-sm-12"> \n                    <label class="control-label col-xs-2 p-l-0 p-r-0" for="">提醒谁看 : </label>\n                    <div class="col-xs-10">\n                    <select style="width:100%" v-model="remind" multiple class="form-control input-sm" id="remindWho">\n                    </select>\n                    </div>\n                </div>\n                <div class="form-group col-sm-6"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">重要程度 : </label>\n                    <div class="col-xs-8 star">\n                    <i class="fa fa-star-o htz-star" @click="xx(\'1\')" style="font-size: 24px;margin-right: 5px;cursor:pointer"></i>\n                    <i class="fa fa-star-o htz-star" @click="xx(\'2\')" style="font-size: 24px;margin-right: 5px;cursor:pointer"></i>\n                    <i class="fa fa-star-o htz-star" @click="xx(\'3\')"  style="font-size: 24px;margin-right: 5px;cursor:pointer"></i>\n                    </div>\n                </div>\n                <div class="form-group col-sm-6"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">跟进状态<span class="text-danger">*</span> : </label>\n                    <div class="col-xs-8">\n                                                    <select name="status" v-model="status" class="form-control">\n                                    <option value="">请选择</option>\n                                    <option value="0">未处理</option>\n                                    <option value="1">初步沟通</option>\n                                    <option value="2">无意向</option>\n                                    <option v-if="role==\'电销员工\' ||role==\'电销主管\' " value="13">潜在客户</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="12">有意向存疑</option>\n                                    <option value="3">有意向</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="4">销售外访</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="5">客户来访</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="6">需求确定</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="7">方案/报价</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="8">谈判/合同</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="9">成交</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="10">暂时搁置</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="11">未成交</option>\n                                </select>\n                    </div>\n                </div>\n                <div class="form-group col-sm-6"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">联系人 : </label>\n                    <div class="col-xs-8">\n                    <input v-if="dialogMode==0" type="text" readonly v-model="linkmanName" class="form-control input-sm  p-r-0"  name="" value="">   \n                    <div v-show="dialogMode==1">\n                     <select style="width:100%" v-model="linkmanId" multiple class="form-control input-sm" id="linkmanId"></select>\n                    </div>\n                    </div>\n                </div>\n                <div class="form-group col-sm-6"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">下次跟进时间 : </label>\n                    <div class="col-xs-8">\n                    <input type="text" @click="laydate($event)" readonly placeholder="选择下次跟进时间" v-model="nextTime" class="form-control input-sm  p-r-0"  name="" value="">     \n                    </div>\n                </div>\n            </form>\n        </div>\n \t\t\t\t ',props:["dialogMode","callId"],data:function(){return{role:localStorage.userRole||"",type:0,time:"",content:"",files:[],remind:[],status:"",customerId:"",customerName:"",linkmanName:"",linkmanId:[],nextTime:"",select_init:0,score:0}},created:function(){},mounted:function(){var n=this;n.$watch("callId",function(e,t){e&&(n.time=laydate.now((new Date).getTime(),"YYYY-MM-DD hh:mm"))})},methods:{init:function(e,t){console.log(this.dialogMode),1==this.dialogMode?this.type="":this.type=0,e&&(this.customerId=e.id||"",this.customerName=e.name||"",this.linkmanName=t||e.linkmanName||"");var n=this;layer.open({scrollbar:!0,type:"1",title:"写跟进",content:$("#follow-box"),area:["700px","620px"],btn:["保存"],btnAlign:"c",yes:function(){n.save()},end:function(){n.remindWhoBox.val(null).trigger("change"),n.linkmanBox.val(null).trigger("change"),n.content="",window.callId="",n.files=[],n.remind=[],n.status="",n.customerId="",n.customerName="",n.linkmanName="",n.linkmanId=[],n.nextTime="",n.score=0,$(".htz-star").eq(0).removeClass("active"),$(".htz-star").eq(1).removeClass("active"),$(".htz-star").eq(2).removeClass("active")},success:function(){n.select_init||(n.remindWhoBox=$("#remindWho").select2({placeholder:"请选择",language:"zh-CN",allowClear:!0,ajax:{url:"/user/getUserInfo",dataType:"json",type:"post",delay:250,data:function(e){return{page:e.page||1,ROLE_ID:"cf54c0b5567542e084778c3f5b230054,b729e9334ad64c15a4e47d88b8c2638f,01dc6d29f1704efeab0376d327f47d98,30b1487221464d369ca4c2462ccca920,04fe5e23842f4b998216080bc3b61821,b693f826af0545b5a1c60447a27c3089,45efba0a0fa946aebf7befe614c74e55,4cb60182bb294cfba622f951e390bc6f",data:{q:e.term||""}}},processResults:function(e,t){return t.page=t.page||1,$.each(e,function(){this.id=this.USER_ID,this.text=this.NAME}),{results:e,pagination:{more:10==e.length}}},cache:!0},minimumInputLength:0}).on("change",function(){n.remind=[];for(var e=0;e<this.children.length;e++)this.children[e].selected&&n.remind.push(this.children[e].value)}),n.linkmanBox=$("#linkmanId").select2({placeholder:"请选择",language:"zh-CN",allowClear:!0,ajax:{url:"/linkman/getLinkmanInfo",dataType:"json",type:"post",delay:250,data:function(e){return{page:e.page||1,data:{q:e.term||""},id:n.customerId,type:3}},processResults:function(e,t){return t.page=t.page||1,$.each(e,function(){this.id=this.linkmanName,this.text=this.linkmanName}),{results:e,pagination:{more:10==e.length}}},cache:!0},minimumInputLength:0}).on("change",function(){n.linkmanId=[];for(var e=0;e<this.children.length;e++)this.children[e].selected&&n.linkmanId.push(this.children[e].value)}),n.select_init=1,n.$parent.loading(),o(["webuploader"],function(e){app.loading("close");var t=e.create({server:"/contract/uploadAttachment.do",runtimeOrder:"html5",pick:{id:"#followFilesUploadBtn",innerHTML:"上传附件"},resize:!1,fileNumLimit:10});t.on("uploadSuccess",function(e,t){n.files.push(t)}),t.on("uploadStart",function(){n.$parent.loading()}),t.on("uploadError",function(e){layer.msg("上传出错")}),t.on("error",function(e){"Q_TYPE_DENIED"==e&&layer.msg("上传文件格式错误，请检查")}),t.on("uploadFinished",function(e){t.reset(),n.$parent.loading("close")}),t.on("fileQueued",function(){t.upload()})}))}})},save:function(){var t=this;if(top.callId||0!=this.dialogMode)if(""!==this.status)if(""!==this.type){var e={content:this.content,files:this.files,remind:this.remind,status:this.status,customerId:this.customerId,nextTime:this.nextTime,customerName:this.customerName,score:this.score};0==this.dialogMode&&(e.callId=top.callId),this.linkmanName?(e.linkmanId=[],e.linkmanId.push(this.linkmanName)):e.linkmanId=this.linkmanId,e.type=this.type,yocto.json("/saleCustomer/saveProcessInfo",e,function(e){layer.closeAll(),layer.msg("销售动态保存成功"),t.$parent&&t.$parent.getCaseRecord&&t.$parent.getCaseRecord(),window.parentFnc&&window.parentFnc()})}else layer.msg("请选择跟进方式");else layer.msg("请选择跟进状态");else layer.msg("请挂断电话之后再保存记录")},files_del:function(e){var t=this,n=layer.confirm("确认删除此项?",function(){t.files.splice(e,1),layer.close(n)})},laydate:function(o){function e(e,t,n){return o.apply(this,arguments)}return e.toString=function(){return o.toString()},e}(function(e,t,n){var o=this;laydate({vEvent:e,format:"YYYY-MM-DD hh:mm:ss",istime:!0,istoday:!0,choose:function(e){n?o.time=e:o.nextTime=e}})}),xx:function(e){1==e?(this.score=1,$(".htz-star").eq(0).addClass("active"),$(".htz-star").eq(1).removeClass("active"),$(".htz-star").eq(2).removeClass("active")):2==e?(this.score=2,$(".htz-star").eq(0).addClass("active"),$(".htz-star").eq(1).addClass("active"),$(".htz-star").eq(2).removeClass("active")):3==e&&(this.score=3,$(".htz-star").eq(0).addClass("active"),$(".htz-star").eq(1).addClass("active"),$(".htz-star").eq(2).addClass("active")),console.log(this.score)}}})});