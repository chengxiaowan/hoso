"use strict";var config={isKhGh:yo.getQueryString("isKhGh")||0,role:localStorage.userRole,api_yjzb:"/yjzb/addYjzb",api_showSaleCustomer:"/yjzb/showYjzbList",api_del:"/yjzb/deleteYjzb",api_jxxz:"/yjzb/addJxxz",api_yjxzList:"/yjzb/showYjxzList",api_deleteyjxz:"/yjzb/deleteYjxz",htz_gw:[],api_money:"/yjzb/showXzDetail",api_del_other:"/yjzb/deleteById",api_addOrUpdate:"/yjzb/addOrUpdateDxandTs",api_showRoleListByFdzb:"/yjzb/showRoleListByFdzb",api_addOrUpdateTcgz:"/yjzb/addOrUpdateTcgz",api_tcgzList:"/yjzb/showTcgzList",api_deleteTcgzById:"/yjzb/deleteTcgzById",api_tcgzDetail:"/yjzb/findById",api_dkje:"/yjzb/getMoneyByUserId",api_dktcgw:"/yjzb/getDktcGw?flag=0",api_dktcgw1:"/yjzb/getDktcGw?flag=1&roleId="};require(["dateTimeInit"]),"销售精英"!=config.role&&"经理"!=config.role||(config.isKhGh=4),require(["select2"],function(e){window.app=new Vue({el:"#app",data:{c:{list:[]},d:{list:[]},dixin:{list:[]},teshu:{list:[]},swgwList:{list:[]},dxswgwList:{list:[]},postDataswgwList:{},ind:1,role:config.role,isKhGh:config.isKhGh,type:0,postData:{},postData1:{},postData2:{},postRule:{},postDktc:{},postdxswgw:{},rule:{ruleName:"",ruleList:"",ruleBracket:"",ruleBonus:"",ruleJob:"",job:[],list:[],ruleBracket1:"",ruleJob1:"",job1:[],list1:[],ruleBracket2:"",ruleJob2:"",job2:[]},dxswgw:{ruleName:"",ruleList:"",ruleBracket:"",ruleBonus:"",ruleJob:"",job:[],list:[],ruleBracket1:"",ruleJob1:"",job1:[],list1:[],ruleBracket2:"",ruleJob2:"",job2:[]},checkAll:0,checks:[],posting:!1,hoverParam:"",editParam:"",oldData:"",s:{lastSaleName:{},lastSaleName1:{},lastSaleName2:{},lastSaleName3:{},name:"",gwName:"",dkName:"",job:[],jobName:[]},select2:{saleId:{}},saleFollowMode:1,htz_gw:[],htz_tczb:!0,htz_table:{dhl:!1,khs:!1,zg:!1,qdl:!1,bfl:!1,fdzb:[],tc:[]},jobName:"提成岗位",kind:"",hoverEl:{name:{show:0,el:{}},linkmanLandline:{show:0,el:{}},linkmanMobilePhone:{show:0,el:{}},email:{},postion:{show:0,el:{}},linkmanName:{show:0,el:{}},remark:{show:0,el:{}}},editEl:{show:"",el:{},oldValue:""},newYear:(new Date).getFullYear().toString(),aType:"",newYear1:(new Date).getFullYear().toString(),newYear2:""},watch:{"rule.ruleJob1":function(e){""!=e&&$.get(config.api_dkje,{userId:e},function(e){$(".dkje").val(e.result.targetDetail)}),$(".dkje").val("0")}},computed:{},created:function(){document.getElementById("app").classList.remove("hide")},mounted:function(){var a=this;this.list_Get(),this.changeSale(),laydate.render({elem:"#newYear",type:"year",done:function(e,t){a.newYear=e}}),laydate.render({elem:"#newYear1",type:"year",done:function(e,t){a.newYear1=e}}),laydate.render({elem:"#newYear2",type:"year",done:function(e,t){a.newYear2=e}}),laydate.render({elem:"#year",type:"year",done:function(e,t){a.year=e}})},directives:{focus:{inserted:function(e){e.focus()}}},methods:{reset:function(){this.s.lastSaleName.val(null).trigger("change")},reset1:function(){this.s.lastSaleName1.val(null).trigger("change")},addAchievement:function(){var a=this;$("#year").val(""),$("#achievementType").val("0");var l=layer.open({type:1,title:"新增业绩指标",closeBtn:1,content:$("#achievementBox"),area:["480px","220px"],btn:"确定",btnAlign:"c",yes:function(){var e=$("#year").val(),t=$("#achievementType  option:selected").val();a.postData.year=e,a.postData.type=t,""!=e?$.get(config.api_yjzb,a.postData,function(e){"00"==e.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get()):layer.msg(e.msg)}):layer.msg("请选择年度")}})},customer_edit:function(e){var t;0==e.type?t="电销电话量指标":1==e.type?t="电销意向客户数指标":2==e.type?t="商务顾问到款任务指标":3==e.type?t="商务顾问合同数量指标":4==e.type?t="商务顾问订单金额指标":5==e.type?t="商务顾问拜访量指标":6==e.type?t="运作到款任务":7==e.type?t="商务顾问辞退待定指标":8==e.type?t="电销商务顾问客户约访数":9==e.type?t="电销商务顾问客户签约数":10==e.type&&(t="电销商务顾问订单标的金额");var a=layer.open({type:2,title:e.year+"年度"+t,closeBtn:1,content:"achievement_edit.html?id="+e.id+"&type="+e.type+"&index="+a,area:["100%","100%"]})},del:function(e){var t=this,a=layer.confirm("删除该业绩指标后，该业绩指标的考核方案同样删除，是否确定删除该业绩指标?",{title:"提示"},function(){$.get(config.api_del,{parentId:e},function(e){"00"==e.error?(layer.close(a),layer.msg("删除成功"),t.list_Get()):layer.msg(e.msg)})})},s1:function(){var a=this;$("#newYear2").val(""),$("#h1").val("0");var l=layer.open({type:1,title:"新增商务顾问提成规则设置",closeBtn:1,content:$("#s1"),area:["480px","220px"],btn:"确定",btnAlign:"c",yes:function(){var e=$("#newYear2").val(),t=$(".hello  option:selected").val();a.postData.year=e,a.postData.type=t,""!=e?$.get(config.api_yjzb,a.postData,function(e){"00"==e.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_GetSwgw()):layer.msg(e.msg)}):layer.msg("请选择年度")}})},del_sw:function(e){var t=this,a=layer.confirm("删除该提成规则，员工不再享有提成，是否确定删除该提成规则?",{title:"提示"},function(){$.get(config.api_del,{parentId:e},function(e){"00"==e.error?(layer.close(a),layer.msg("删除成功"),t.list_GetSwgw()):layer.msg(e.msg)})})},customer_editSw:function(e){var t;11==e.type?t="拜访量":12==e.type&&(t="签单量");var a=layer.open({type:2,title:e.year+"年度"+t,closeBtn:1,content:"achievementsw_edit.html?id="+e.id+"&type="+e.type+"&index="+a,area:["100%","100%"]})},addSalary:function(){var a=this;$("#salaryType").val("0"),$("#salaryName").val("");var l=layer.open({type:1,title:"新增业绩指标",closeBtn:1,content:$("#salaryBox"),area:["480px","220px"],btn:"确定",btnAlign:"c",yes:function(){var e=$("#salaryType  option:selected").val(),t=$("#salaryName").val();a.postData.name=t,a.postData.type=e,""!=t?$.get(config.api_jxxz,a.postData,function(e){"00"==e.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get1()):layer.msg(e.msg)}):layer.msg("请输入绩效名称")}})},del_xz:function(e){var t=this,a=layer.confirm("删除该绩效薪资后，员工后续将不会享受到该绩效薪资提成，是否确定删除该绩效薪资?",{title:"提示"},function(){$.get(config.api_deleteyjxz,{parentId:e},function(e){"00"==e.error?(layer.close(a),layer.msg("删除成功"),t.list_Get1()):layer.msg(e.msg)})})},del_other:function(e){var t=this,a=layer.confirm("删除该员工的底薪后，该员工不再享有基础薪资，是否确定删除该员工的底薪?",{title:"提示"},function(){$.get(config.api_del_other,{id:e},function(e){"00"==e.error?(layer.close(a),layer.msg("删除成功"),t.list_Get2()):layer.msg(e.msg)})})},deltc:function(e,t){var a=this,l=layer.confirm("删除该提成规则，员工不再享有提成，是否确定删除该提成规则?",{title:"提示"},function(){$.get(config.api_deleteTcgzById,{id:e},function(e){"00"==e.error?(layer.close(l),layer.msg("删除成功"),3==t?a.list_Get4():5==t?a.list_Getdxswgw():a.list_Get5()):layer.msg(e.msg)})})},Salary_edit:function(e){var t;0==e.type?t="电销绩效薪资":1==e.type?t="团队管理绩效薪资":2==e.type&&(t="商务顾问浮动薪资");layer.open({type:2,title:t,closeBtn:1,content:"achievement_jxxz.html?id="+e.id+"&type="+e.type,area:["100%","100%"]})},adddixin:function(){var a=this;this.s.lastSaleName.val(null).trigger("change"),$(".yggw").val(""),$("#dixin").val("");var l=layer.open({type:1,title:"新增底薪",closeBtn:1,content:$("#dixinBox"),area:["480px","270px"],btn:"确定",btnAlign:"c",yes:function(){var e=$("#salechange").val(),t=$("#dixin").val();a.postData1.userId=e,a.postData1.targetDetail=t,a.postData1.flag=1,""!=e?""!=t?$.get(config.api_addOrUpdate,a.postData1,function(e){"00"==e.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.postData1.userId="",a.postData1.targetDetail="",a.list_Get2()):layer.msg(e.msg)}):layer.msg("请输入薪资"):layer.msg("请输入员工姓名")}})},dixi_edit:function(t){var a=this;$(".xgsale").val(t.name),$(".xgsaleJob").val(t.roleName),$("#xgdixin").val(t.targetDetail);var l=layer.open({type:1,title:"新增底薪",closeBtn:1,content:$("#xgdixinBox"),area:["480px","270px"],btn:"确定",btnAlign:"c",yes:function(){var e=$("#xgdixin").val();a.postData1.id=t.id,""!=(a.postData1.targetDetail=e)?$.get(config.api_addOrUpdate,a.postData1,function(e){"00"==e.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get2()):layer.msg(e.msg)}):layer.msg("请输入薪资")}})},addteshu:function(){var a=this;this.s.lastSaleName1.val(null).trigger("change"),$(".tsyggw").val(""),$("#tcbl").val("");var l=layer.open({type:1,title:"新增特殊员工提成",closeBtn:1,content:$("#teshuBox"),area:["480px","270px"],btn:"确定",btnAlign:"c",yes:function(){var e=$("#tssalechange").val(),t=$("#tcbl").val();a.postData2.userId=e,a.postData2.targetDetail=t,a.postData2.flag=2,""!=e?""!=t?$.get(config.api_addOrUpdate,a.postData2,function(e){"00"==e.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.postData2.userId="",a.postData2.targetDetail="",a.list_Get3()):layer.msg(e.msg)}):layer.msg("请输入提成比例"):layer.msg("请输入员工姓名")}})},teshu_edit:function(t){var a=this;$(".xgsale1").val(t.name),$(".xgsaleJob1").val(t.roleName),$("#xgdixin1").val(t.targetDetail);var l=layer.open({type:1,title:"修改特殊员工提成",closeBtn:1,content:$("#xgdixinBox1"),area:["480px","270px"],btn:"确定",btnAlign:"c",yes:function(){var e=$("#xgdixin1").val();a.postData1.id=t.id,""!=(a.postData1.targetDetail=e)?$.get(config.api_addOrUpdate,a.postData1,function(e){"00"==e.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get3()):layer.msg(e.msg)}):layer.msg("请输入提成比例")}})},loading:function(e){"close"==e?layer.close(this.loadingSwitch):this.loadingSwitch=layer.load(3)},tab:function(e){var t=this;1==e&&t.list_Get(),2==e&&t.list_Get1(),3==e&&t.list_Get4(),4==e&&(t.list_Get5(),t.dkjob(),$("select[name=saleName]").val("")),5==e&&(this.s.gwName="",this.s.dkName="",t.list_Get2(),t.kind="",this.s.lastSaleName=this.select_init("[name=saleName]","请选择员工",t.kind,1)),6==e&&(t.list_Get3(),t.kind="fbe6f2f9535c4fce9f024f6cb999b2bd",this.s.lastSaleName1=this.select_init("[name=saleName1]","请选择员工",t.kind,1)),7==e&&t.list_Getdxswgw(),8==e&&t.list_GetSwgw()},search:function(){this.postData1.userId=$(".searchName_1").val(),this.list_Get2()},search1:function(){this.postData2.userId=$("#searchName1").val(),this.list_Get3()},searchDk:function(){this.postDktc.roleId=this.s.gwName,this.postDktc.userId=this.s.dkName,this.list_Get5()},dSearch:function(){this.list_Get()},dSearch1:function(){this.list_GetSwgw()},list_Get:function(){var t=this;t.postData.flag=0,t.postData.year=t.newYear,t.postData.type=t.aType,t.loading(),$.ajax({url:config.api_showSaleCustomer,data:t.postData}).done(function(e){t.c.list=e.result,t.loading("close")})},list_Get1:function(){var t=this;t.loading(),$.ajax({url:config.api_yjxzList,data:t.postData}).done(function(e){t.d.list=e.result,t.loading("close")})},list_Get2:function(){var t=this;t.loading(),t.postData1.flag=1,$.ajax({url:config.api_money,data:t.postData1}).done(function(e){t.dixin.list=e.result,t.loading("close")})},list_Get3:function(){var t=this;t.loading(),t.postData2.flag=2,$.ajax({url:config.api_money,data:t.postData2}).done(function(e){t.teshu.list=e.result,t.loading("close")})},list_Get4:function(){var t=this;t.loading(),$.ajax({url:config.api_tcgzList,data:{flag:0}}).done(function(e){t.rule.list=e.result,t.loading("close")})},list_Get5:function(){var t=this;t.postDktc.flag=1,t.loading(),$.ajax({url:config.api_tcgzList,data:t.postDktc}).done(function(e){t.rule.list1=e.result,t.loading("close")})},list_GetSwgw:function(){var t=this;t.postDataswgwList.flag=1,t.postDataswgwList.year=t.newYear1,t.loading(),$.ajax({url:config.api_showSaleCustomer,data:t.postDataswgwList}).done(function(e){t.swgwList.list=e.result,t.loading("close")})},list_Getdxswgw:function(){var t=this;t.loading(),$.ajax({url:config.api_tcgzList,data:{flag:2}}).done(function(e){t.dxswgwList.list=e.result,t.loading("close")})},select_init:function(e,t,a,l,n){return $(e).select2({placeholder:t||"请选择",language:"zh-CN",allowClear:l||!1,ajax:{url:"/user/getUserInfo",dataType:"json",type:"post",delay:250,data:function(e){return{page:e.page||1,ROLE_ID:n||a,data:{q:e.term||""}}},processResults:function(e,t){return t.page=t.page||1,config.htz_gw=e,$.each(e,function(){this.id=this.USER_ID,this.text=this.NAME}),{results:e,pagination:{more:10==e.length}}},cache:!0},minimumInputLength:0})},dkjob:function(){var t=this;$.get(config.api_dktcgw,{},function(e){t.s.job=e.result})},gwName:function(){var t=this,e=t.s.gwName;""!=e?$.get(config.api_dktcgw1+e,{},function(e){t.s.jobName=e.result}):(t.s.dkName="",t.s.jobName=[])},changeSale:function(){$("#salechange").on("change",function(){for(var e=$(this).val(),t=0;t<config.htz_gw.length;t++)config.htz_gw[t].USER_ID==e&&(console.log(config.htz_gw[t].USER_ID,e),$(".yggw").val(config.htz_gw[t].ROLE_NAME))}),$("#tssalechange").on("change",function(){for(var e=$(this).val(),t=0;t<config.htz_gw.length;t++)config.htz_gw[t].USER_ID==e&&(console.log(config.htz_gw[t].USER_ID,e),$(".tsyggw").val(config.htz_gw[t].ROLE_NAME))})},addRule:function(){var a=this;a.rule.ruleName="",a.rule.ruleList="",a.rule.ruleBracket="",a.rule.ruleBonus="",a.rule.ruleJob="",a.htz_table.dhl=!1,a.htz_table.khs=!1,a.htz_table.zg=!1,a.htz_table.qdl=!1,a.htz_table.bfl=!1;var l=layer.open({type:1,title:"新增电销提成规则",closeBtn:1,content:$("#ruleBox"),area:["850px","600px"],btn:"确定",btnAlign:"c",yes:function(){a.postRule.name=a.rule.ruleName,a.postRule.tcStandard=a.rule.ruleList,a.postRule.fdStandard=a.rule.ruleBracket,a.postRule.yjStandard=a.rule.ruleBonus,a.postRule.roleId=a.rule.ruleJob;var n,s=[];if($(".aaa td:not(:last-child)").each(function(){$(this).find(".a1").each(function(){var e={};e.fdzb=$(this).val(),s.push(e)});for(var e=$(this).find(".a2"),t=0;t<e.length;t++)if(n=$(".aaa td .a2").eq(t).val(),t<2)s[t].tc=n;else{var a=$(".aaa td .a2").eq(2).val(),l=$(".aaa td .a2").eq(3).val();s[2].tc=a+","+l}}),a.postRule.yjtcList=s,""!=a.postRule.name)if(""!=a.postRule.tcStandard)if(""!=a.postRule.fdStandard)if(""!=a.postRule.yjStandard||1!=a.htz_tczb)if(""!=a.postRule.roleId){for(var e=$(".aaa input"),t=0;t<e.length;t++)if(""==e[t].value)return void layer.msg("请填写规则");yocto.json(config.api_addOrUpdateTcgz,a.postRule,function(e){"00"==e.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get4()):"01"==e.error&&layer.msg(e.msg)})}else layer.msg("请选择岗位");else layer.msg("请选择提成指标");else layer.msg("请选择分档指标");else layer.msg("请选择提成规则");else layer.msg("请输入规则名称")}})},changeRule:function(){var t=this;(t.rule.ruleJob="")!=t.rule.ruleBracket?(3==t.rule.ruleBracket||4==t.rule.ruleBracket?(t.htz_tczb=!1,t.jobName="提成部门"):(t.htz_tczb=!0,t.jobName="提成岗位"),0==t.rule.ruleBracket?t.htz_table.dhl=!0:t.htz_table.dhl=!1,1==t.rule.ruleBracket?t.htz_table.khs=!0:t.htz_table.khs=!1,2==t.rule.ruleBracket?t.htz_table.zg=!0:t.htz_table.zg=!1,3==t.rule.ruleBracket?t.htz_table.qdl=!0:t.htz_table.qdl=!1,4==t.rule.ruleBracket?t.htz_table.bfl=!0:t.htz_table.bfl=!1,$.ajax({url:config.api_showRoleListByFdzb,async:!1,data:{fdStandard:t.rule.ruleBracket}}).done(function(e){t.rule.job=e.result})):t.rule.ruleJob=""},xg_tc:function(a){var l=this;$.get(config.api_tcgzDetail,{id:a.id,flag:0},function(e){var i=e.result;l.rule.ruleName=i.name,l.rule.ruleList=i.tcStandard,l.rule.ruleBracket=i.fdStandard,null==i.yjStandard?(l.htz_tczb=!1,l.jobName="提成部门"):(l.htz_tczb=!0,l.jobName="提成岗位",l.rule.ruleBonus=i.yjStandard),0==i.fdStandard?l.htz_table.dhl=!0:l.htz_table.dhl=!1,1==i.fdStandard?l.htz_table.khs=!0:l.htz_table.khs=!1,2==i.fdStandard?l.htz_table.zg=!0:l.htz_table.zg=!1,3==i.fdStandard?l.htz_table.qdl=!0:l.htz_table.qdl=!1,4==i.fdStandard?l.htz_table.bfl=!0:l.htz_table.bfl=!1,setTimeout(function(){for(var r=0;r<i.yjtcList.length;r++)$(".aaa td:not(:last-child)").each(function(){for(var e=$(this).find(".a1"),t=0;t<e.length;t++)$(".aaa td .a1").eq(t).val(i.yjtcList[t].fdzb);for(var a=$(this).find(".a2"),l=0;l<a.length;l++)if(2<i.yjtcList.length){$(".aaa td .a2").eq(0).val(i.yjtcList[0].tc),$(".aaa td .a2").eq(1).val(i.yjtcList[1].tc);for(var n=i.yjtcList[2].tc.split(","),s=0;s<n.length;s++)$(".aaa td .a2").eq(2).val(n[0]),$(".aaa td .a2").eq(3).val(n[1])}else $(".aaa td .a2").eq(r).val(i.yjtcList[r].tc)})},100),$.ajax({url:config.api_showRoleListByFdzb,async:!1,data:{fdStandard:l.rule.ruleBracket}}).done(function(e){l.rule.job=e.result,l.rule.ruleJob=i.roleId})});var n=layer.open({type:1,title:"修改电销提成规则",closeBtn:1,content:$("#ruleBox"),area:["850px","600px"],btn:"保存",btnAlign:"c",yes:function(){l.postRule.name=l.rule.ruleName,l.postRule.tcStandard=l.rule.ruleList,l.postRule.fdStandard=l.rule.ruleBracket,l.postRule.yjStandard=l.rule.ruleBonus,l.postRule.roleId=l.rule.ruleJob,l.postRule.id=a.id;var s=[];if($(".aaa td:not(:last-child)").each(function(){$(this).find(".a1").each(function(){var e={};e.fdzb=$(this).val(),s.push(e)});for(var e=$(this).find(".a2"),t=0;t<e.length;t++){var a=$(".aaa td .a2").eq(t).val();if(t<2)s[t].tc=a;else{console.log("进入");var l=$(".aaa td .a2").eq(2).val(),n=$(".aaa td .a2").eq(3).val();s[2].tc=l+","+n}}}),l.postRule.yjtcList=s,console.log(l.postRule.tcStandard),""!=l.postRule.name)if(l.postRule.tcStandard<0)layer.msg("请选择提成规则");else if(l.postRule.fdStandard<0)layer.msg("请选择分档指标");else if(l.postRule.yjStandard<0&&1==l.htz_tczb)layer.msg("请选择提成指标");else if(l.postRule.roleId<0)layer.msg("请选择岗位");else{for(var e=$(".aaa input"),t=0;t<e.length;t++)if(""==e[t].value)return void layer.msg("请填写规则");yocto.json(config.api_addOrUpdateTcgz,l.postRule,function(e){"00"==e.error?(layer.close(n),layer.msg("修改成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),l.list_Get4()):layer.msg(e.msg)})}else layer.msg("请输入规则名称")}})},s2:function(){var a=this;a.dxswgw.ruleName="",a.dxswgw.ruleList="",a.dxswgw.ruleBracket="",a.dxswgw.ruleJob="";var l=layer.open({type:1,title:"新增电销商务顾问提成规则",closeBtn:1,content:$("#s2"),area:["850px","550px"],btn:"确定",btnAlign:"c",yes:function(){a.postdxswgw.name=a.dxswgw.ruleName,a.postdxswgw.tcStandard=a.dxswgw.ruleList,a.postdxswgw.fdStandard=a.dxswgw.ruleBracket,a.postdxswgw.roleId="90564dd8b75a4f6d815ce418462d401c";var n,s=[];if($(".eee td:not(:last-child)").each(function(){$(this).find(".a1").each(function(){var e={};e.fdzb=$(this).val(),s.push(e)});for(var e=$(this).find(".a2"),t=0;t<e.length;t++)if(n=$(".eee td .a2").eq(t).val(),t<2)s[t].tc=n;else{var a=$(".eee td .a2").eq(2).val(),l=$(".eee td .a2").eq(3).val();s[2].tc=a+","+l}}),a.postdxswgw.yjtcList=s,""!=a.postdxswgw.name)if(""!=a.postdxswgw.tcStandard)if(""!=a.postdxswgw.fdStandard){for(var e=$(".aaa input"),t=0;t<e.length;t++)if(""==e[t].value)return void layer.msg("请填写规则");yocto.json(config.api_addOrUpdateTcgz,a.postdxswgw,function(e){"00"==e.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Getdxswgw()):"01"==e.error&&layer.msg(e.msg)})}else layer.msg("请选择分档指标");else layer.msg("请选择提成规则");else layer.msg("请输入规则名称")}})},changedxswgw:function(){var e=this;7==e.dxswgw.ruleBracket?e.dxswgw.a=!0:e.dxswgw.a=!1,8==e.dxswgw.ruleBracket?e.dxswgw.b=!0:e.dxswgw.b=!1,9==e.dxswgw.ruleBracket?e.dxswgw.c=!0:e.dxswgw.c=!1},xg_dxswgwtc:function(a){var l=this;$.get(config.api_tcgzDetail,{id:a.id,flag:0},function(e){var i=e.result;l.dxswgw.ruleName=i.name,l.dxswgw.ruleList=i.tcStandard,l.dxswgw.ruleBracket=i.fdStandard,7==i.fdStandard?l.dxswgw.a=!0:l.dxswgw.a=!1,8==i.fdStandard?l.dxswgw.b=!0:l.dxswgw.b=!1,9==i.fdStandard?l.dxswgw.c=!0:l.dxswgw.c=!1,setTimeout(function(){for(var r=0;r<i.yjtcList.length;r++)$(".eee td:not(:last-child)").each(function(){for(var e=$(this).find(".a1"),t=0;t<e.length;t++)$(".eee td .a1").eq(t).val(i.yjtcList[t].fdzb);for(var a=$(this).find(".a2"),l=0;l<a.length;l++)if(2<i.yjtcList.length){$(".eee td .a2").eq(0).val(i.yjtcList[0].tc),$(".eee td .a2").eq(1).val(i.yjtcList[1].tc);for(var n=i.yjtcList[2].tc.split(","),s=0;s<n.length;s++)$(".eee td .a2").eq(2).val(n[0]),$(".eee td .a2").eq(3).val(n[1])}else $(".eee td .a2").eq(r).val(i.yjtcList[r].tc)})},100)});var n=layer.open({type:1,title:"修改电销商务顾问提成规则",closeBtn:1,content:$("#s2"),area:["850px","550px"],btn:"保存",btnAlign:"c",yes:function(){l.postdxswgw.name=l.dxswgw.ruleName,l.postdxswgw.tcStandard=l.dxswgw.ruleList,l.postdxswgw.fdStandard=l.dxswgw.ruleBracket,l.postdxswgw.roleId="90564dd8b75a4f6d815ce418462d401c",l.postdxswgw.id=a.id;var s=[];if($(".eee td:not(:last-child)").each(function(){$(this).find(".a1").each(function(){var e={};e.fdzb=$(this).val(),s.push(e)});for(var e=$(this).find(".a2"),t=0;t<e.length;t++){var a=$(".eee td .a2").eq(t).val();if(t<2)s[t].tc=a;else{console.log("进入");var l=$(".eee td .a2").eq(2).val(),n=$(".eee td .a2").eq(3).val();s[2].tc=l+","+n}}}),l.postdxswgw.yjtcList=s,""!=l.postdxswgw.name)if(l.postdxswgw.tcStandard<0)layer.msg("请选择提成规则");else if(l.postdxswgw.fdStandard<0)layer.msg("请选择分档指标");else{for(var e=$(".eee input"),t=0;t<e.length;t++)if(""==e[t].value)return void layer.msg("请填写规则");yocto.json(config.api_addOrUpdateTcgz,l.postdxswgw,function(e){"00"==e.error?(layer.close(n),layer.msg("修改成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),l.list_Getdxswgw()):layer.msg(e.msg)})}else layer.msg("请输入规则名称")}})},adddk:function(){$(".cancel_dom ").remove(),$(".ymd1").val("0"),$(".ymd2").val(""),$(".ymd3").val("");var a=this;a.rule.ruleBracket1="",a.rule.ruleJob1="";var n=layer.open({type:1,title:"新增到款提成",closeBtn:1,content:$("#daokuanBox"),area:["850px","400px"],btn:"确定",btnAlign:"c",yes:function(){a.postRule.fdStandard=a.rule.ruleBracket1,a.postRule.roleId=a.rule.ruleJob1;var l=[];if($(".bbb .htz-td:not(:last-child)").each(function(){$(this).find("tr").each(function(){var e,t,a={};$(this).find(".a1").first().each(function(){e=$(this).val()}),$(this).find(".a1").last().each(function(){t=$(this).val(),a.fdzb=e+","+t,l.push(a)})});for(var e=$(this).find(".a2"),t=0;t<e.length;t++){var a=$(".bbb td .a2").eq(t).val();l[t].tc=a}}),a.postRule.yjtcList=l,""!=a.postRule.fdStandard)if(""!=a.postRule.roleId){for(var e=$(".bbb input"),t=0;t<e.length;t++)if(""==e[t].value)return void layer.msg("请填写规则");yocto.json(config.api_addOrUpdateTcgz,a.postRule,function(e){"00"==e.error?(layer.close(n),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get5()):"01"==e.error&&(console.log("111"),layer.msg(e.msg))})}else layer.msg("请选择员工");else layer.msg("请输入分档指标")}})},changeRule1:function(){var t=this;t.rule.ruleJob1="",t.rule.job1=[],""!=t.rule.ruleBracket1?$.ajax({url:config.api_showRoleListByFdzb,async:!1,data:{fdStandard:t.rule.ruleBracket1}}).done(function(e){t.rule.job1=e.result}):t.rule.ruleJob1=""},changeRule2:function(){var t=this;t.rule.ruleJob2="",t.rule.job2=[],""!=t.rule.ruleBracket2?$.ajax({url:config.api_showRoleListByFdzb,async:!1,data:{fdStandard:t.rule.ruleBracket2}}).done(function(e){t.rule.job2=e.result}):t.rule.ruleJob2=""},xinzen:function(){this.ind+=1;$(".xinzeng").append('<tr class="cancel_dom"><td><input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/><span class=" htz-label pull-left" style="margin-top: 12px;width: 10%;">&le;</span><span class=" pull-left" style="margin-top: 12px;display: block;width: 10%; text-align: center;line-height: 34px;">X</span><span class=" htz-label pull-left" style="margin-top: 12px; width: 10%;">&lt;</span><input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/></td></tr>'),$(".xinzeng1").append('<input type="number" class="cancel_dom form-control htz-select a2" />')},xg_dk:function(n){var s=this;$(".cancel_dom ").remove(),$.get(config.api_tcgzDetail,{id:n.id,flag:1},function(t){s.rule.ruleBracket2=t.result.fdStandard;var r,i,o=[],c=[];for(var e=0;e<t.result.yjtcList.length;e++)1<=e&&($(".xz1").append('<tr class="cancel_dom"><td><input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/><span class=" htz-label pull-left" style="margin-top: 12px;width: 10%;">&le;</span><span class=" pull-left" style="margin-top: 12px;display: block;width: 10%; text-align: center;line-height: 34px;">X</span><span class=" htz-label pull-left" style="margin-top: 12px; width: 10%;">&lt;</span><input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/></td></tr>'),$(".xz2").append('<input type="number" class="cancel_dom form-control htz-select a2" />')),r=t.result.yjtcList;$(".ccc .htz-td1:not(:last-child)").each(function(){var e=$(this).find("tr");console.log(e.length);for(var t=$(this).find("tr"),a=0;a<t.length;a++){o=r[a].fdzb.split(","),i=$(this).find("tr .a1"),c.push(o);for(var l=0;l<i.length;l++)e.eq(a).find(".a1:first-child").val(c[a][0]),e.eq(a).find(".a1:last-child").val(c[a][1])}for(var n=$(this).find(".a2"),s=0;s<n.length;s++)$(".ccc td .a2").eq(s).val(r[s].tc)}),$.ajax({url:config.api_showRoleListByFdzb,async:!1,data:{fdStandard:s.rule.ruleBracket2}}).done(function(e){s.rule.job2=e.result,s.rule.ruleJob2=t.result.userId});var a=layer.open({type:1,title:"修改到款提成",closeBtn:1,content:$("#daokuanBox1"),area:["850px","400px"],btn:"保存",btnAlign:"c",yes:function(){s.postRule.fdStandard=s.rule.ruleBracket2,s.postRule.roleId=s.rule.ruleJob2,s.postRule.id=n.id;var l=[];if($(".ccc .htz-td1:not(:last-child)").each(function(){$(this).find("tr").each(function(){var e,t,a={};$(this).find(".a1").first().each(function(){e=$(this).val()}),$(this).find(".a1").last().each(function(){t=$(this).val(),a.fdzb=e+","+t,l.push(a)})});for(var e=$(this).find(".a2"),t=0;t<e.length;t++){var a=$(".ccc td .a2").eq(t).val();l[t].tc=a}}),s.postRule.yjtcList=l,s.postRule.fdStandard<0)layer.msg("请输入分档指标");else if(""!=s.postRule.roleId){for(var e=$(".ccc input"),t=0;t<e.length;t++)if(""==e[t].value)return void layer.msg("请填写规则");yocto.json(config.api_addOrUpdateTcgz,s.postRule,function(e){"00"==e.error?(layer.close(a),layer.msg("修改成功"),$(".cancel_dom").remove(),console.log(".cancel_dom"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),s.list_Get5()):layer.msg(e.msg)})}else layer.msg("请选择员工")},cancel:function(){console.log($(".cancel_dom")),$(".cancel_dom").remove()}})})},edit_hover:function(e,t){Vue.set(this.hoverEl,e,{show:1,el:t})},edit_el:function(e,t){this.editEl.show=e,this.editEl.el=t,this.editEl.oldValue=t.name},edit_submit:function(e,t){console.log(2),this.editEl.show="",this.editEl.el={},Vue.set(this.hoverEl,e,{show:0,el:{}}),this.saveData(e,t)},edit_keyup:function(e,t){console.log(1),this.editEl.show="",this.editEl.el={},Vue.set(this.hoverEl,e,{show:0,el:{}})},saveData:function(t,a){function e(){var e={id:a.id,type:a.type};e[t]=$.trim(a[t]),$.post(config.api_jxxz,e,function(e){})}"name"!=t||""!=a.name?"name"==t&&a.name==this.editEl.oldValue||e():a.name=this.editEl.oldValue}}})}),window.parentFnc=function(e){layer.closeAll(),window.app.getCaseRecord(window.app.type)};