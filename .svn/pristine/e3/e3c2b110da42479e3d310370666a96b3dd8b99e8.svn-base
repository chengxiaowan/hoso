"use strict";var config={isKhGh:yo.getQueryString("isKhGh")||0,role:localStorage.userRole,api_detail:"/main/showdfSaleProcessDetail.do",time:yo.getQueryString("time"),id:yo.getQueryString("id"),saleName:yo.getQueryString("saleName"),api_user:"/user/getUserInfo"};"销售精英"!=config.role&&"经理"!=config.role||(config.isKhGh=4);var dxOnly={title:{text:"",textStyle:{color:"#3a3a3a",fontStyle:"normal",fontSize:18}},tooltip:{trigger:"axis"},legend:{data:["电话量","意向客户数"]},grid:{x:40,x2:40},xAxis:[{type:"category",data:["四月","五月","六月","七月","八月","九月","十月","十一月","十二月","一月","二月","三月"]}],yAxis:[{type:"value",name:"电话量",position:"left"},{type:"value",name:"意向客户数",position:"right"}],series:[{name:"电话量",type:"bar",data:[],barWidth:10,itemStyle:{normal:{color:"#459df5"}}},{name:"意向客户数",type:"bar",yAxisIndex:1,data:[],barWidth:10,itemStyle:{normal:{color:"#53c1a6"}}}]},labelTop={normal:{color:"#fdb54e",label:{show:!0,position:"center",formatter:"{b}",textStyle:{baseline:"top",fontSize:14}},labelLine:{show:!1}}},labelFromatter={normal:{label:{formatter:function(e){return 100-e.value+"%"},textStyle:{baseline:"top"}}}},labelBottom={normal:{color:"#d3d6da",label:{show:!0,position:"center",fontSize:12},labelLine:{show:!1}},emphasis:{color:"#d3d6da"}},radius=["80%","90%"],pieChartOption={title:{text:"",subtext:"",x:"center"},animation:!1,tooltip:{trigger:"axis",showDelay:0,hideDelay:50,transitionDuration:0,borderRadius:8,borderWidth:2,padding:10},series:[{type:"pie",center:["50%","55%"],radius:radius,x:"0%",itemStyle:labelTop,data:[{name:"0%",value:0,itemStyle:labelTop},{name:"电话量进度",value:0,itemStyle:labelBottom}]}]},labelTop2={normal:{color:"#53c1a6",label:{show:!0,position:"center",formatter:"{b}",textStyle:{baseline:"top",fontSize:14}},labelLine:{show:!1}}},labelFromatter2={normal:{label:{formatter:function(e){return 100-e.value+"%"},textStyle:{baseline:"top"}}}},labelBottom2={normal:{color:"#d3d6da",label:{show:!0,position:"center",fontSize:12},labelLine:{show:!1}},emphasis:{color:"#d3d6da"}},radius2=["80%","90%"],pieChartOption2={title:{text:"",subtext:"",x:"center"},animation:!1,tooltip:{trigger:"axis",showDelay:0,hideDelay:50,transitionDuration:0,borderRadius:8,borderWidth:2,padding:10},series:[{type:"pie",center:["50%","55%"],radius:radius2,x:"0%",itemStyle:labelTop,data:[{name:"0%",value:0,itemStyle:labelTop2},{name:"意向客户数进度",value:0,itemStyle:labelBottom2}]}]};require(["select2"],function(e){window.app=new Vue({el:"#app",data:{dxmonth:config.time.split("-")[0],dx:{dhl:"",mbdhl:"",yxkhs:"",mbyxkhs:"",list:[]},saleId:config.id,listId:[],idchange:"",sjbt:""},watch:{dxmonth:function(e){this.getDataDx(e,this.saleId,1)},saleId:function(e){this.getDataDx(this.dxmonth,e,2)}},computed:{},created:function(){document.getElementById("app").classList.remove("hide")},mounted:function(){var a=this;laydate.render({elem:"#dxmonth",type:"year",done:function(e,t){a.dxmonth=e}}),this.getDataDx(this.dxmonth,config.id),this.getUser()},methods:{loading:function(e){"close"==e?layer.close(this.loadingSwitch):this.loadingSwitch=layer.load(3)},getUser:function(){var t=this;t.loading(),$.ajax({type:"post",url:config.api_user,async:!0,data:{ROLE_ID:"7d2f882f13ea48e0a4c8acaeea53b3a5,30b1487221464d369ca4c2462ccca920,01dc6d29f1704efeab0376d327f47d98"},success:function(e){t.loading("close"),t.listId=e}})},getDataDx:function(e,d,h){var c,m,x,p,y=this,u=y.nowMonth(),g=u;y.loading(),$.ajax({url:config.api_detail,async:!0,data:{startTime:e+"-04",endTime:Number(e)+1+"-03",saleId:d},success:function(e){if(y.loading("close"),"00"==e.error){y.dx.list=e.result;for(var t=[],a=[],i=0;i<e.result.length;i++){var l=e.result[i];t.push(l.dhl),a.push(l.yxkhs)}if(null==h)for(i=0;i<e.result.length;i++){l=e.result[i];u==l.time&&(y.idchange=i,y.dx.dhl=l.dhl||0,y.dx.mbdhl=l.mbdhl||0,y.dx.yxkhs=l.yxkhs||0,y.dx.mbyxkhs=l.mbyxkhs||0,"Infinity"==(c=Math.round(l.dhl/l.mbdhl*1e4)/100)?c=100:isNaN(c)&&(c=0),m=c+"%","Infinity"==(x=Math.round(l.yxkhs/l.mbyxkhs*1e4)/100)?x=100:isNaN(x)&&(x=0),p=x+"%",y.dxhx(c,m,x,p,g,d))}else if(1==h||2==h){var n=e.result[y.idchange].time;y.dx.dhl=e.result[y.idchange].dhl||0,y.dx.mbdhl=e.result[y.idchange].mbdhl||0,y.dx.yxkhs=e.result[y.idchange].yxkhs||0,y.dx.mbyxkhs=e.result[y.idchange].mbyxkhs||0,"Infinity"==(c=Math.round(y.dx.dhl/y.dx.mbdhl*1e4)/100)?c=100:isNaN(c)&&(c=0),m=c+"%","Infinity"==(x=Math.round(y.dx.yxkhs/y.dx.mbyxkhs*1e4)/100)?x=100:isNaN(x)&&(x=0),p=x+"%",y.dxhx(c,m,x,p,n,d)}var o=Number(Math.max.apply(null,t));o+=.2*o;var s=Number(Math.max.apply(null,a));s+=s;var r=echarts.init(document.getElementById("dxOnly"));dxOnly.series[0].data=t,dxOnly.series[1].data=a,dxOnly.yAxis[0].max=Math.ceil(o),dxOnly.yAxis[1].max=Math.ceil(s),r.setOption(dxOnly),r.off("click"),r.on("click",function(e){if(0==e.seriesIndex||1==e.seriesIndex){g=y.dx.list[e.dataIndex].time;var t=y.dx.list[e.dataIndex];y.dx.dhl=t.dhl||0,y.dx.mbdhl=t.mbdhl||0,y.dx.yxkhs=t.yxkhs||0,y.dx.mbyxkhs=t.mbyxkhs||0,c=Math.round(t.dhl/t.mbdhl*1e4)/100,console.log(c),"Infinity"==c?c=100:isNaN(c)&&(c=0),m=c+"%","Infinity"==(x=Math.round(t.yxkhs/t.mbyxkhs*1e4)/100)?x=100:isNaN(x)&&(x=0),p=x+"%",y.dxhx(c,m,x,p,g,d)}})}else layer.msg(e.msg)}})},dxhx:function(e,t,a,i,l,n){var o=l.split("-"),s=o[0],r=o[1],d=new Date(s,r,0).getDate();t0=l+"-01",t1=l+"-"+d,pieChartOption.series[0].data[0].name=t,pieChartOption.series[0].data[0].value=e,pieChartOption.series[0].data[1].value=100-e,pieChartOption.title.text=l+"月份";var h=document.getElementById("pie"),c=echarts.init(h);c.setOption(pieChartOption),c.off("click"),c.on("click",function(e){var t="/static/page/index/saler_follow_list.html?startTime="+t0+"&endTime="+t1+"&type=1&saleId="+n+"&saleName="+config.saleName;layer.open({type:2,title:"电话量",content:t,area:["100%","100%"]})}),pieChartOption2.series[0].data[0].name=i,pieChartOption2.series[0].data[0].value=a,pieChartOption2.series[0].data[1].value=100-a,pieChartOption2.title.text=l+"月份";var m=document.getElementById("pie2"),x=echarts.init(m);x.setOption(pieChartOption2),x.off("click"),x.on("click",function(e){layer.open({type:2,title:"意向客户数",content:"/static/page/index/saler_customer_list.html?startTime="+t0+"&endTime="+t1+"&saleId="+n+"&saleName="+config.saleName,area:["100%","100%"]})})},nowMonth:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1;return a=a<10?"0"+a:a,t.toString()+"-"+a.toString()}}})}),window.parentFnc=function(e){layer.closeAll(),window.app.getCaseRecord(window.app.type)};