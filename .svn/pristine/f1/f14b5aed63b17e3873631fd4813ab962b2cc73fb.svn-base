"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},config={isKhGh:yo.getQueryString("isKhGh")||0,role:localStorage.userRole,api_showSaleCustomer:"/saleCustomer/showSaleCustomer",api_qdKhgh:"/saleCustomer/qdKhgh",api_import:"/saleCustomer/importExcel.do",api_moveKh:"/saleCustomer/moveKh.do",api_del:"/saleCustomer/delete.do",api_isGh:"/saleCustomer/isGh"};require(["dateTimeInit"]),require(["select2"],function(e){window.app=new Vue({el:"#app",data:{c:{list:[]},role:config.role,isKhGh:config.isKhGh,postData:{},checkAll:0,checks:[],posting:!1,s:{lastSaleName:{},provinceName:"",cityName:"",areaName:""},isCream:"商务顾问J"==config.role||"经理"==config.role,select2:{privince:{},city:{},saleId:{},area:{}},citys_sub:[],citys_sub1:[],isGh:1,isActive1:!1,isActive2:!1,isActive3:!1,isActive4:!1,isActive5:!1},watch:{"s.provinceName":{handler:function(){var i=this.s.provinceName,s=[],a=void 0;console.log(i),$.each(this.citys["省份"],function(e,t){i==t.regionName&&(a=t.id)}),$.each(this.citys["市区"],function(e,t){a==t.parentId&&s.push(t)}),this.citys_sub=s,Vue.set(this.citys_sub)},deep:!0},"s.cityName":{handler:function(){var i=this.s.provinceName,s=this.s.cityName,a=[],o=void 0,c=void 0;console.log(s),$.each(this.citys["省份"],function(e,t){i==t.regionName&&(o=t.id)}),$.each(this.citys["市区"],function(e,t){o==t.parentId&&s==t.regionName&&(c=t.id,console.log(c))}),$.each(this.citys["区"],function(e,t){c==t.parentId&&a.push(t)}),this.citys_sub1=a,Vue.set(this.citys_sub1)},deep:!0}},computed:{},created:function(){var s=this;document.getElementById("app").classList.remove("hide"),localStorage.citys&&(this.citys=JSON.parse(localStorage.citys)),"高级商务顾问S2"==config.role||"高级商务顾问S3"==config.role||"经理"==config.role?(s.isKhGh=6,s.isActive1=!0):"高级商务顾问S1"==config.role?(s.isKhGh=7,s.isActive2=!0):"商务顾问J"==config.role?(s.isKhGh=4,s.isActive3=!0):"电销员工"==config.role||"电销主管"==config.role?(s.isKhGh=5,s.isActive4=!0):1==s.isGh&&(s.isKhGh=3,s.isActive5=!0),require(["webuploader"],function(e){s.uploader=e.create({server:config.api_import,formData:{isKhgh:s.isKhGh},timeout:0,runtimeOrder:"html5",pick:{id:"#excel_fileUp",innerHTML:"导入客户"},resize:!1,fileNumLimit:10}),s.uploader.on("uploadSuccess",function(e,t){if(s.uploader.reset(),s.loading("close"),t.result)var i=layer.alert("上传成功<br>以下项目有重复无法导入:<br>"+t.result,function(){s.list_Get(1),layer.close(i)});else layer.msg("上传成功"),setTimeout(function(){s.list_Get(1)},2e3)}),s.uploader.on("uploadStart",function(){s.loading()}),s.uploader.on("uploadError",function(e){layer.msg("上传出错")}),s.uploader.on("error",function(e){"Q_TYPE_DENIED"==e&&layer.msg("上传文件格式错误，请检查")}),s.uploader.on("uploadFinished",function(e){}),s.uploader.on("fileQueued",function(){s.uploader.upload()})})},mounted:function(){this.$watch("checks",function(e,t){i.checks.length==i.c.list.length&&0!=i.checks.length?i.checkAll=1:i.checkAll=0}),this.s.lastSaleName=this.select_init("[name=saleName]","请选择前负责人",1);var i=this;this.select2.province=$("select[name=provinceName]").select2({language:"zh-CN",placeholder:"请选择",allowClear:1}).on("change",function(){i.s.provinceName=this.value,i.select2.city.val(null).trigger("change")}),i.select2.city=$("select[name=cityName]").select2({language:"zh-CN",placeholder:"请选择",allowClear:1}).on("change",function(){i.s.cityName=this.value,i.select2.area.val(null).trigger("change")}),i.select2.area=$("select[name=area]").select2({language:"zh-CN",placeholder:"请选择",allowClear:1}).on("change",function(){i.s.areaName=this.value}),this.sf(),this.list_Get(),this.select2.saleId=this.select_init("#salerId","请选择",!1)},methods:{clear:function(){this.s.lastSaleName.val(null).trigger("change"),this.select2.province.val(null).trigger("change"),this.select2.city.val(null).trigger("change"),this.select2.area.val(null).trigger("change"),this.postData.createTimeStart="",this.postData.createTimeEnd=""},btn_checkAll:function(){var e=this;e.checks=[],e.checkAll&&$.each(e.c.list,function(){e.checks.push(this.id)})},shiftToOther:function(){var t=this;if(this.checks.length){4==this.isKhGh&&(this.select2.saleId.select2("destroy"),this.select2.saleId=this.select_init("#salerId","请选择",!1,"b729e9334ad64c15a4e47d88b8c2638f"));var i=layer.open({type:1,title:"转移客户",closeBtn:1,content:$("#salerBox"),area:["350px","200px"],btn:"转移",btnAlign:"c",end:function(){t.select2.saleId.select2("destroy"),t.select2.saleId=t.select_init("#salerId")},yes:function(){if($("#salerId").val()){var e="";0==t.isKhGh?e=0:3==t.isKhGh?e=1:1==t.isKhGh?e=3:4==t.isKhGh&&(e=4),yocto.json(config.api_moveKh,{id:t.checks,saleId:$("#salerId").val(),type:e},function(e){layer.close(i),layer.msg("转移成功"),t.list_Get(1)})}else layer.close(i)}})}else layer.msg("请先选择一项进行操作")},del:function(){var t=this;if(this.checks.length)var i=layer.confirm("确认删除客户?",function(){yocto.json(config.api_del,{id:t.checks},function(e){layer.close(i),layer.msg("删除成功"),t.list_Get(1)})});else layer.msg("请先选择一项进行操作")},loading:function(e){"close"==e?layer.close(this.loadingSwitch):this.loadingSwitch=layer.load(3)},sale_Get:function(e){var t=[];if("object"!=(void 0===e?"undefined":_typeof(e)))t.push(e);else{if(!this.checks.length)return void layer.msg("请先选择一项进行操作");t=this.checks}var i=this,s="";0==i.isKhGh?s=0:3==i.isKhGh?s=1:1==i.isKhGh?s=3:4==i.isKhGh&&(s=4),$.post(config.api_qdKhgh,{ids:t.join(","),type:s}).done(function(e){e.result?layer.msg(e.result):layer.msg("操作成功,请在潜在客户查看"),i.list_Get()})},tab:function(e){this.isKhGh!=e&&(this.clear(),this.isKhGh=e,$("#searchForm")[0].reset(),this.s.lastSaleName.val(null).trigger("change"),this.postData.saleName="",this.postData.status="",this.checks=[],this.checkAll=0,this.list_Get(1),this.uploader.option("formData",{isKhgh:this.isKhGh}))},search:function(){this.postData.saleName=$.trim($("[name=saleName]").val()),this.postData.status=$.trim($("[name=status]").val()),this.postData.provinceName=$.trim($("[name=provinceName]").val()),this.postData.cityName=$.trim($("[name=cityName]").val()),this.postData.area=$.trim($("[name=area]").val()),this.postData.keywords=$.trim($("[name=keywords]").val()),console.log(this.postData),this.list_Get(1)},list_Get:function(t){$(".appWrapper").scrollTop(0),this.checks=[];var i=this;t&&(this.c.pageNum=t),i.loading(),i.postData.isKhGh=this.isKhGh,i.postData.pageSize=this.c.pageSize,i.postData.pageNo=this.c.pageNum,require(["pagination"],function(e){$.ajax({url:config.api_showSaleCustomer,async:!1,data:i.postData}).done(function(e){i.c=e.result,i.pagi?($(".pagi").pagination("updatePages",i.c.pages),1==t&&$(".pagi").pagination("goToPage",i.c.pageNum)):(i.pagi=1,$(".pagi").pagination({pages:i.c.pages,showCtrl:!0,displayPage:6,currentPage:i.c.pageNum,onSelect:function(e){i.c.pageNum=e,i.list_Get()}})),i.loading("close")})})},select_init:function(e,t,i,s){return $(e).select2({placeholder:t||"请选择",language:"zh-CN",allowClear:i||!1,ajax:{url:"/user/getUserInfo",dataType:"json",type:"post",delay:250,data:function(e){return{page:e.page||1,ROLE_ID:s||"b729e9334ad64c15a4e47d88b8c2638f,30b1487221464d369ca4c2462ccca920",data:{q:e.term||""}}},processResults:function(e,t){return t.page=t.page||1,$.each(e,function(){this.id=this.USER_ID,this.text=this.NAME}),{results:e,pagination:{more:10==e.length}}},cache:!0},minimumInputLength:0})},sf:function(){$.get(config.api_isGh,function(e){"00"==e.error&&("有"==e.msg?this.isGh=1:this.isGh=2)})}}})}),window.parentFnc=function(e){layer.closeAll(),window.app.getCaseRecord(window.app.type)};