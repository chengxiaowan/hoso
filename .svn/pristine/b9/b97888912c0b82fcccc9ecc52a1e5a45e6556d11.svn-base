"use strict";var config={isKhGh:yo.getQueryString("isKhGh")||0,role:localStorage.userRole,api_detail:"/mainIndex/showYzjbDetatil",time:yo.getQueryString("time"),id:yo.getQueryString("id"),saleName:yo.getQueryString("saleName"),api_user:"/user/getUserInfo"};"销售精英"!=config.role&&"经理"!=config.role||(config.isKhGh=4);var app={},option=null;option={title:{text:"",textStyle:{color:"#3a3a3a",fontStyle:"normal",fontSize:16}},tooltip:{trigger:"axis"},legend:{data:["商务顾问业绩目标完成情况"]},xAxis:{type:"category",data:[]},yAxis:{type:"value",max:""},series:[{data:[],type:"line",symbol:"circle",symbolSize:6,areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#d9ebfd"},{offset:.5,color:"#f6fafe"},{offset:.8,color:"#ffffff"}])}},itemStyle:{normal:{color:"#459df5"}}}]};var labelTop={normal:{color:"#fdb54e",label:{show:!0,position:"center",formatter:"{b}",textStyle:{baseline:"top",fontSize:14}},labelLine:{show:!1}}},labelFromatter={normal:{label:{formatter:function(e){return 100-e.value+"%"},textStyle:{baseline:"top"}}}},labelBottom={normal:{color:"#d3d6da",label:{show:!0,position:"center",fontSize:12},labelLine:{show:!1}},emphasis:{color:"#d3d6da"}},radius=["80%","90%"],pieChartOption={title:{text:"",subtext:"",x:"center"},animation:!1,tooltip:{trigger:"axis",showDelay:0,hideDelay:50,transitionDuration:0,borderRadius:8,borderWidth:2,padding:10},series:[{type:"pie",center:["50%","55%"],radius:radius,x:"0%",itemStyle:labelTop,data:[{name:"0%",value:0,itemStyle:labelTop},{name:"到款金额进度",value:0,itemStyle:labelBottom}]}]};require(["select2"],function(e){window.app=new Vue({el:"#app",data:{dxmonth:config.time,dx:{dkje:"",mbdkje:"",list:[],gxtime:""},saleId:config.id,listId:[]},watch:{dxmonth:function(e){this.getYjmb()},saleId:function(e){this.getYjmb()}},computed:{},created:function(){document.getElementById("app").classList.remove("hide")},mounted:function(){var a=this;laydate.render({elem:"#dxmonth",type:"year",done:function(e,t){a.dxmonth=e}}),this.getYjmb(),this.getUser()},methods:{loading:function(e){"close"==e?layer.close(this.loadingSwitch):this.loadingSwitch=layer.load(3)},getUser:function(){var t=this;t.loading(),$.ajax({type:"post",url:config.api_user,async:!0,data:{ROLE_ID:"02178e62f17b4926bb7014f3ad5a1ebe"},success:function(e){t.loading("close"),t.listId=e}})},getYjmb:function(){var d,c,m=this,e=m.dxmonth+"-04-01",t=Number(m.dxmonth)+1+"-03-31";$.ajax({type:"post",url:config.api_detail,async:!0,data:{startTime:e,endTime:t,runnerId:m.saleId},success:function(a){if(m.loading("close"),"00"==a.error){for(var e=[],t=[],i=0,o=0,n=0;n<a.result.length;n++){var l=a.result[n];i+=Number(a.result[n].dkje),o+=Number(a.result[n].mbdkje),e.push(l.time),t.push(l.dkje)}m.dx.dkje=i,m.dx.mbdkje=o,"Infinity"==(d=Math.round(i/o*1e4)/100)?d=100:isNaN(d)&&(d=0),c=d+"%",m.dxhx(d,c);var r=Number(Math.max.apply(null,t));r+=.2*r;var s=echarts.init(document.getElementById("main"));option.xAxis.data=e,option.yAxis.max=Math.ceil(r),option.series[0].data=t,s.setOption(option),s.off("click"),s.on("click",function(e){var t="/static/page/index/saler_yunzuo_list.html?gxtime="+a.result[e.dataIndex].time+"&saleId="+m.saleId;layer.open({type:2,title:"运作到款金额明细",content:t,area:["100%","100%"]})})}else layer.msg(a.msg)}})},dxhx:function(e,t){var a=this;pieChartOption.series[0].data[0].name=t,pieChartOption.series[0].data[0].value=e,pieChartOption.series[0].data[1].value=100-e;var i=document.getElementById("pie"),o=echarts.init(i);o.setOption(pieChartOption),o.off("click"),o.on("click",function(e){var t="/static/page/index/saler_yunzuo_list1.html?gxtime="+a.dxmonth+"&saleId="+a.saleId;layer.open({type:2,title:"运作到款金额明细",content:t,area:["100%","100%"]})})},nowMonth:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1;return a=a<10?"0"+a:a,t.toString()+"-"+a.toString()}}})}),window.parentFnc=function(e){layer.closeAll(),window.app.getCaseRecord(window.app.type)};